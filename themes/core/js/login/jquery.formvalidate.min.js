
(function($){$.fn.findAndSelf=function(selector){return this.find(selector).add(this.filter(selector));};$.fn.closestAndSelf=function(selector){return this.closest(selector).add(this.filter(selector));};String.prototype.sprintf=function(params){var string=this;$.each(params,function(index,param){string=string.replace('{'+index+'}',param);});return string;};Date.prototype.createFromFormat=function(input,format){var now=new Date();var dateArray=input.split(/[.,\/ \-]/);if(dateArray.length===3){for(var dateSegment in dateArray){if(dateArray[dateSegment]%1!=0){throw new Error('Invalid date segment provided.');}
else{dateArray[dateSegment]=parseInt(dateArray[dateSegment],10);}}
var year,month,day;switch(format){case'YYYY-MM-DD':year=dateArray[0];month=dateArray[1]-1;day=dateArray[2];break;case'DD-MM-YYYY':year=dateArray[2];month=dateArray[1]-1;day=dateArray[0];break;default:year=dateArray[2];month=dateArray[0]-1;day=dateArray[1];break;}
if(year>=1&&month>=0&&month<=11&&day>=1&&day<=31){var date=new Date(now.getTime());date.setHours(0,0,0,0);date.setFullYear(year,month,day);if(date.getFullYear()===year&&date.getMonth()===month&&date.getDate()===day){this.setFullYear(year,month,day);this.setHours(0,0,0,0);}}}
else{throw new Error('Invalid date provided.');}
if(this.getTime()===now.getTime()){throw new Error('Invalid date provided.');}
return this;};$.fn.formvalidate=function(options){options=$.extend(true,{},$.fn.formvalidate.options,options);return this.each(function(){this.options=options;this.result=false;this.inputs={};this.options.preProcess.call(this,this,this.options,this.options.inputFailureClass,this.options.inputSuccessClass,this.options.messageFailureClass,this.options.messageSuccessClass,this.options.messageElement,this.options.messageParent);this.options._process.call(this,this,this.options);this.options._validate.call(this,this,this.options);this.options.postProcess.call(this,this,this.inputs);this.options._displayMessages(this,this.inputs);this.result===true?this.options.onSuccess(this,this.inputs,this.options):this.options.onFailure(this,this.inputs,this.options);});};$.fn.formvalidate.options={preProcess:function(form,options,inputFailureClass,inputSuccessClass,messageFailureClass,messageSuccessClass,messageElement){var inputFailureClassString=inputFailureClass.replace(' ','.');var inputSuccessClassString=inputSuccessClass.replace(' ','.');$(form).find(':input.'+inputFailureClassString+', :input.'+inputSuccessClassString).removeClass(inputFailureClass+' '+inputSuccessClass);var messageFailureClassString=messageFailureClass.replace(' ','.');var messageSuccessClassString=messageSuccessClass.replace(' ','.');$(form).find('.'+messageFailureClassString+', .'+messageSuccessClassString).remove();},_process:function(form,options){var inputs={};$(form).find(':input').each(function(index,element){var attrName=$(element).attr('name');var data=$(element).data();if(!attrName){return;}
if(!(attrName in inputs)){inputs[attrName]={};}
if(!('required'in inputs[attrName])||inputs[attrName].required===false){inputs[attrName].required=$(element).hasClass('required')||'required'in data;}
if(!('value'in inputs[attrName])){var value=null;if($(element).is(':checkbox')){value=[];$(':input[name="'+attrName+'"]:checked').each(function(checkboxIndex,checkboxElement){value[checkboxIndex]=$(checkboxElement).val();});}
else if($(element).is(':radio')){var radio=$(':input[name="'+attrName+'"]:checked');if(radio.length){value=$(radio).val();}}
else{value=$(element).val()===''?null:$(element).val();}
inputs[attrName].value=value;}
if(!('title'in inputs[attrName])){var title=null;if('title'in data){title=data.title;}
if(!title){title=$(':input[name="'+attrName+'"][title!=""]:first').attr('title');}
if(!title){var id=$(':input[name="'+attrName+'"][id!=""]:first').attr('id');title=$('label[for="'+id+'"]').text();}
if(!title){title=$('label :input[name="'+attrName+'"]:first').closest('label').text();}
inputs[attrName].title=title;}
inputs[attrName].success=null;inputs[attrName].failure=null;inputs[attrName].messages={failure:[],success:[]};if(!('validations'in inputs[attrName])){inputs[attrName].validations={};}
if(!('filters'in inputs[attrName])){inputs[attrName].filters={};}
$.each(options.validations,function(validation,method){if(validation==='required'){var required=$(element).hasClass('required')||'required'in data;if(required===true){inputs[attrName].validations.required=[true];}}
else if(validation==='requiredIf'){if('requiredIf'in data){inputs[attrName].validations.requiredIf=[data.requiredIf];}}
else if(validation in data){inputs[attrName].validations[validation]=data[validation].toString().split(' ');}});$.each(options.filters,function(filter,method){if(filter in data){var filterParams=[attrName];filterParams.push(typeof param==='string'?data[filter].split(' '):null);inputs[attrName].filters[filter]=filterParams;}});});this.inputs=inputs;this.result=null;return this;},postProcess:function(form,inputs){return form;},_validate:function(form,options){var result=true;var message=null;$.each(form.inputs,function(inputName,inputObj){if(inputObj.filters){$.each(inputObj.filters,function(filterName,filterParams){if(filterName in options.filters&&inputObj.value!==null){inputObj.value=options.filters[filterName](inputObj.value,filterParams);}});}
if(inputObj.validations){$.each(inputObj.validations,function(validationName,validationParams){if(inputObj.failure===null){if(validationName in options.validations){if(inputObj.value===null&&validationName!=='required'&&validationName!=='requiredIf'){return true;}
if(options.validations[validationName](inputObj.value,validationParams)===true){validationParams.unshift(inputObj.title,inputObj.value);if(inputName in options.localization[options.language].success){if(typeof options.localization[options.language].success[inputName]==='function'){message=options.localization[options.language].success[inputName](inputObj.title,inputObj.value,inputName,inputObj).sprintf(validationParams);}
else{message=options.localization[options.language].success[inputName].sprintf(validationParams);}}
else if('default'in options.localization[options.language].success){message=options.localization[options.language].success.default.sprintf(validationParams);}
inputObj.messages.success.push(message);}
else{validationParams.unshift(inputObj.title,inputObj.value);if(validationName in options.localization[options.language].failure){if(typeof options.localization[options.language].failure[validationName]==='function'){message=options.localization[options.language].failure[validationName](inputObj.title,inputObj.value,inputName,inputObj).sprintf(validationParams);}
else{message=options.localization[options.language].failure[validationName].sprintf(validationParams);}}
else if('default'in options.localization[options.language].failure){message=options.localization[options.language].failure['default'].sprintf(validationParams);}
result=false;inputObj.success=false;inputObj.failure=true;inputObj.messages.failure.push(message);}}}});inputObj.success=inputObj.success===null?true:false;inputObj.failure=inputObj.failure===null?false:true;}});this.result=result;return this;},_displayMessages:function(form,inputs){if(form.options.failureMessages===false&&form.options.successMessages===false){return false;}
$.each(inputs,function(inputIndex,inputObj){if(form.options.failureMessages===true&&inputObj.failure===true){$(form).find(':input[name="'+inputIndex+'"]').addClass(form.options.inputFailureClass);var el=$(form.options.messageElement).addClass(form.options.messageFailureClass).text(inputObj.messages.failure[0]);$(form).find(':input[name="'+inputIndex+'"]:last').closestAndSelf(form.options.messageParent).append(el);}
else if(form.options.successMessages===true){$(form).find(':input[name="'+inputIndex+'"]').addClass(form.options.inputSuccessClass);var el=$(form.options.messageElement).addClass(form.options.messageSuccessClass).text(inputObj.messages.success[0]);$(form).find(':input[name="'+inputIndex+'"]:last').closestAndSelf(form.options.messageParent).append(el);}});},onSuccess:function(form,inputs,options){if('submit'in form){form.submit();}},onFailure:function(form,inputs,options){},messageParent:'div',messageElement:'<span />',failureMessages:true,successMessages:false,messageFailureClass:'error',messageSuccessClass:'success',inputFailureClass:'error',inputSuccessClass:'success',language:'en',localization:{en:{failure:{'default':'{0} is invalid.',betweenNumeric:'{0} must be between {2} and {3}.',date:'{0} must be a valid date.',email:'{1} is not a valid email.',numChars:'{0} must be exactly {2} characters.',minChars:'{0} must be at least {2} characters.',maxChars:'{0} cannot be more than {2} characters.',numOptions:'Must select exactly {2} options.',minOptions:'Must select at least {2} options.',maxOptions:'Cannot select more than {2} options.','int':'{0} must be a whole number (integer).','float':'{0} must be a valid number.',required:'{0} Input required.',requiredIf:'{0} Input required.',lessThan:'{0} must be less than {2}.',greaterThan:'{0} must be greater than {2}.'},success:{'default':'{0} is valid'}}},filters:{trim:function(input,params){if(typeof input==='string'){return $.trim(input)===''?null:$.trim(input);}
else{return input;}},strtoupper:function(input,params){if(typeof input==='string'){return input.toUpperCase();}
else{return input;}},strtolower:function(input,params){if(typeof input==='string'){return input.toLowerCase();}
else{return input;}}},validations:{betweenNumeric:function(input,params){return(parseFloat(input)>=parseFloat(params[0])&&parseFloat(input)<=parseFloat(params[1]))?true:false;},date:function(input,params){try{var date=new Date();date.createFromFormat(input,params[0]);return true;}
catch(e){return false;}},dateAfter:function(input,params){},dateBefore:function(input,params){},email:function(input,params){return input.search(/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i)==-1?false:true;},numChars:function(input,params){return input.length===parseInt(params[0],10);},minChars:function(input,params){return input.length>=parseInt(params[0],10);},maxChars:function(input,params){return input.length<parseInt(params[0],10);},numOptions:function(input,params){if(input instanceof Array){return input.length===parseInt(params[0],10)?true:false;}
else{return false;}},minOptions:function(input,params){if(input instanceof Array){return input.length>=parseInt(params[0],10)?true:false;}
else{return false;}},maxOptions:function(input,params){if(input instanceof Array){return input.length>parseInt(params[0],10)?false:true;}
else{return false;}},'int':function(input,params){return input%1==0;},'float':function(input,params){return!isNaN(parseFloat(input))&&isFinite(input);},required:function(input,params){if(input instanceof Array){return input.length>0?true:false;}
else{return input===''||input===null||input===false?false:true;}},requiredIf:function(input,params){var el=$('#'+params[0]);var dependent=null;if($(el).is(':checkbox')||$(el).is(':radio')){dependent=$(el).is(':checked')?true:null;}
else{dependent=$.trim($(el).val())===''?null:$.trim($(el).val());}
return(dependent!==null||dependent===[])&&input===null?false:true;},lessThan:function(input,params){return parseFloat(input)<parseFloat(params[0]);},greaterThan:function(input,params){return parseFloat(input)>parseFloat(params[0]);}}};})(jQuery);